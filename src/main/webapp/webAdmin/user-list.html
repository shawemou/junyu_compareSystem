<!DOCTYPE HTML>
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
<!-- <link rel="Bookmark" href="favicon.ico">
<link rel="Shortcut Icon" href="favicon.ico" /> -->
<!--[if lt IE 9]>
<script type="text/javascript" src="lib/html5.js"></script>
<script type="text/javascript" src="lib/respond.min.js"></script>
<![endif]-->
<link rel="stylesheet" type="text/css" href="static/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="static/h-ui.admin/css/style.css" />
<!--[if IE 6]>
<script type="text/javascript" src="http://lib.h-ui.net/DD_belatedPNG_0.0.8a-min.js" ></script>
<script>DD_belatedPNG.fix('*');</script><![endif]-->
<!--/meta 作为公共模版分离出去-->

<title>用户管理</title>
<meta name="keywords" content="">
<meta name="description" content="">
</head>

<body>
	<!--_header 作为公共模版分离出去-->
	<header class="navbar-wrapper">
		<div class="navbar navbar-fixed-top">
			<div class="container-fluid cl">
				<a class="logo navbar-logo f-l mr-10 hidden-xs" href="javascript:;"></a><font size="3"></font>
				<a class="logo navbar-logo-m f-l mr-10 visible-xs" href="javascript:;"></a> <span class="logo navbar-slogan f-l mr-10 hidden-xs">上海市房屋状况信息中心</span>
				<a aria-hidden="false" class="nav-toggle Hui-iconfont visible-xs" href="javascript:;">&#xe667;</a>
				<nav class="nav navbar-nav"></nav>
				<nav id="Hui-userbar" class="nav navbar-nav navbar-userbar hidden-xs">
					<ul class="cl">
						<li>管理员</li>
						<li class="dropDown dropDown_hover"><a href="#" class="dropDown_A">admin <i class="Hui-iconfont">&#xe6d5;</i></a>
							<ul class="dropDown-menu menu radius box-shadow">
								<li><a href="/CompareSystem/login.html">退出</a></li>
							</ul></li>
						<li id="Hui-skin" class="dropDown right dropDown_hover"><a href="javascript:;" class="dropDown_A" title="换肤"><i class="Hui-iconfont" style="font-size: 18px">&#xe62a;</i></a>
							<ul class="dropDown-menu menu radius box-shadow">
								<li><a href="javascript:;" data-val="default" title="默认（黑色）">默认（黑色）</a></li>
								<li><a href="javascript:;" data-val="blue" title="蓝色">蓝色</a></li>
								<li><a href="javascript:;" data-val="green" title="绿色">绿色</a></li>
								<li><a href="javascript:;" data-val="red" title="红色">红色</a></li>
								<li><a href="javascript:;" data-val="yellow" title="黄色">黄色</a></li>
								<li><a href="javascript:;" data-val="orange" title="橙色">橙色</a></li>
							</ul></li>
					</ul>
				</nav>
			</div>
		</div>
	</header>
	<!--/_header 作为公共模版分离出去-->

	<!--_menu 作为公共模版分离出去-->
	<aside class="Hui-aside">

		<div class="menu_dropdown bk_2">
			<dl id="menu-article">
				<dt class="selected">
					<i class="Hui-iconfont">&#xe616;</i> 管理<i class="Hui-iconfont menu_dropdown-arrow">&#xe6d5;</i>
				</dt>
				<dd style="display: block">
					<ul>
						<li class="current"><a href="user-list.html" title="用户管理">用户管理</a></li>
						<li class="current"><a href="business-list.html" title="业务查询">业务查询</a></li>
						<li class="current"><a href="rate-list.html" title="银行使用率">银行统计</a></li>
						<li class="current"><a href="offline-list.html" title="离线用户清单">离线清单</a></li>
					</ul>
				</dd>
			</dl>

		</div>
	</aside>
	<div class="dislpayArrow hidden-xs">
		<a class="pngfix" href="javascript:void(0);" onClick="displaynavbar(this)"></a>
	</div>
	<!--/_menu 作为公共模版分离出去-->

	<section class="Hui-article-box">
		<nav class="breadcrumb">
			<i class="Hui-iconfont">&#xe67f;</i> 管理<span class="c-gray en">&gt;用户管理<a class="btn btn-success radius r" style="line-height: 1.6em; margin-top: 3px" href="javascript:location.replace(location.href);" title="刷新"><i class="Hui-iconfont">&#xe68f;</i></a>
		</nav>
		<div class="Hui-article">
			<article class="cl pd-20">
				<div class="text-c">
					<div style="padding: 5px; float: left;">
						<label> 手机号码: </label> <input class="input-text" placeholder=" 手机号码" style="width: 250px" name="mobile" maxlength="18" id="mobile" type="text" /> <span class="alert-msg">&nbsp;</span> <label> 机主姓名: </label> <input class="input-text" placeholder=" 机主姓名" style="width: 250px" name="name"
							maxlength="18" id="name" type="text" /> <span class="alert-msg">&nbsp;</span>
						<!-- <label>日期范围：</label>
					 	<input type="text" onfocus="WdatePicker({maxDate:'#F{$dp.$D(\'logmax\')||\'%y-%M-%d\'}'})" id="logmin" class="input-text Wdate" style="width: 120px;"> - <input type="text" onfocus="WdatePicker({minDate:'#F{$dp.$D(\'logmin\')}',maxDate:'%y-%M-%d'})" id="logmax"
						class="input-text Wdate" style="width: 120px;"> -->
					</div>
					<div style="padding: 5px; float: left;">
						<label>用户状态:</label> <select class="input-text" style="width: 250px" name="busable" id="busable">
							<option value>全部</option>
							<option value="1">启用</option>
							<option value="2">停用</option>
						</select><span class="alert-msg">&nbsp;</span> <label>用户类型&nbsp:</label> <select class="input-text" style="background-color: #c9daf8; width: 250px" name="parenttype" id="parenttype"></select> <span class="alert-msg">&nbsp;</span>
					</div>
					<div id="bankBranch" style="padding: 5px; float: left; display: none">
						<label>机构分支:</label> <select class="input-text" style="background-color: #c9daf8; width: 250px" name="typeGuid" maxlength="25" id="typeGuid"></select><span class="alert-msg">&nbsp;</span>
					</div>
					<div style="padding: 5px; float: left">
						<button name="" id="user_search" class="btn btn-success" type="submit">
							<i class="Hui-iconfont">&#xe665;</i> 查询
						</button>
					</div>
				</div>
				<div style="padding: 5px; float: left; width: 1100px">
					<span class="l"> <a class="btn btn-primary radius" data-title="添加资讯" _href="article-add.html" onclick="article_add('添加用户','user-add.html')" href="javascript:;"><i class="Hui-iconfont">&#xe600;</i> 添加用户</a>
					</span>
				</div>
				<div class="mt-20">

					<table id="user_list" class="table table-border table-bordered table-bg table-hover table-sort">
						<thead>
							<tr class="text-c">
								<th width="25"><input type="text" name="guid" value=""></th>
								<th width="100">登录名</th>
								<th width="100">手机号码</th>
								<th width="90">密码</th>
								<th width="150">用户 类型</th>
								<th width="110">姓名</th>
								<th width="50">性别</th>
								<th width="150">证件号码</th>
								<th width="60">状态</th>
								<th width="60">重置密码</th>
								<th width="25">编辑</th>
							</tr>
						</thead>
					</table>
				</div>
			</article>
		</div>
	</section>

	<!--_footer 作为公共模版分离出去-->
	<script type="text/javascript" src="lib/jquery/1.9.1/jquery.min.js"></script>
	<script type="text/javascript" src="lib/layer/2.4/layer.js"></script>
	<script type="text/javascript" src="static/h-ui/js/H-ui.js"></script>
	<script type="text/javascript" src="static/h-ui.admin/js/H-ui.admin.page.js"></script>
	<!--/_footer /作为公共模版分离出去-->

	<!--请在下方写此页面业务相关的脚本-->
	<script type="text/javascript" src="lib/My97DatePicker/4.8/WdatePicker.js"></script>
	<script type="text/javascript" src="lib/datatables/1.10.0/jquery.dataTables.min.js"></script>
	<script type="text/javascript" src="lib/laypage/1.2/laypage.js"></script>
	<script type="text/javascript" src="js/common.js"></script>
	<script type="text/javascript">
		//所有的子类型 和 担保公司
		typeArr = {};
		//所有的总行 和 担保公司 和 市中心
		typePareArr = {};
		//所有的用户类型
		allType = {};
		//获取上面三个参数的值
		getAllBank()
		//获取所有的父级type
		showAllType();
		$("#parenttype [value=000]").insertBefore($("#parenttype [value=10]"));
		$("#parenttype [value=999]").insertBefore($("#parenttype [value=10]"));

		var param = {};
		param["mobile"] = $("#mobile").val();
		param["name"] = $("#name").val();
		param["parenttype"] = $("#parenttype").val();
		param["typeGuid"] = $("#typeGuid").val();
		param["busable"] = $("#busable").val();

		$("#user_search").click(function() {
			param["mobile"] = $("#mobile").val();
			param["name"] = $("#name").val();
			param["parenttype"] = $("#parenttype").val();
			param["typeGuid"] = $("#typeGuid").val();
			param["busable"] = $("#busable").val();
			mytable.ajax.reload();
		})

		myStart();
		/* getAllBank();
		showAllType() */
		function myStart() {
			mytable = $('.table-sort')
					.DataTable(
							{
								"searching" : true,
								"ajax" : { //ajax方式向后台发送请求
									"type" : "POST",
									"url" : "/CompareSystem/web/webDateList1.do",
									"data" : function(d) {
										d.mobile = param.mobile;
										d.name = param.name;
										d.parenttype = param.parenttype;
										d.typeGuid = param.typeGuid;
										d.busable = param.busable;
									},//传递的数据
									"dataType" : "json",
									"async" : false,
									"dataSrc" : "aaData"
								},
								//开启表格分页
								"paging" : true,
								"bProcessing" : true,
								"bServerSide" : true,
								"bAutoWidth" : false,
								"deferRender" : true,//延迟渲染
								"iDisplayLength" : 10,
								"iDisplayStart" : 0,
								"Language" : { // 国际化配置
									"sProcessing" : "正在获取数据，请稍后...",
									"sLengthMenu" : "显示 _MENU_ 条",
									"sZeroRecords" : "没有找到数据",
									"sInfo" : "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",
									"sInfoEmpty" : "记录数为0",
									"sInfoFiltered" : "(全部记录数 _MAX_ 条)",
									"sInfoPostFix" : "",
									"sSearch" : "查询",
									"sUrl" : "",
									"oPaginate" : {
										"sFirst" : "第一页",
										"sPrevious" : "上一页",
										"sNext" : "下一页",
										"sLast" : "最后一页"
									}
								},
								//渲染
								"columnDefs" : [
										{
											"visible" : false,
											"targets" : 0
										},
										{
											//用户类型
											"render" : function(data, type, row) {
												return allType[data] == null ? "" : allType[data];
											},
											"targets" : 4
										},
										{
											//性别
											"render" : function(data, type, row) {
												return data == 1 ? "男" : data == 1 ? "女" : "未知";
											},
											"targets" : 6
										},
										{
											//状态
											"render" : function(data, type, row) {
												return data == 1 ? "<font usable="+data+" guid="+row.guid+" color='green'>启用</font>"
														: "<font color='red'>停用</font>";
											},
											"targets" : 8
										},
										{
											//重置密码
											"render" : function(data, type, row) {
												return "<a guid="+row.guid +" onclick='updatePwd(this)'> 重置密码</a>";
											},
											"targets" : 9
										},
										{
											//编辑
											"render" : function(data, type, row) {
												return "<a style='text-decoration:none' name='edit' row='"+ JSON.stringify(row)+ "' class='ml-5' onclick='gotoEdit(this)'  href='javascript:;' title='编辑'><i class='Hui-iconfont'>&#xe6df;</i></a>"
											},
											"targets" : 10
										} ],
								columns : [ {
									data : 'guid'
								}, {
									data : 'loginName'
								}, {
									data : 'mobile'
								}, {
									data : 'password'
								}, {
									data : 'typeGuid'
								}, {
									data : 'name'
								}, {
									data : 'gender'
								}, {
									data : 'idNumber'
								}, {
									data : 'busable'
								} ]
							});
		}

		// 重置密码点击触发事件
	/* 	$("#user_list tbody tr").find("td:eq(8)").click(function() {
			updatePwd(this);
		}).mouseover(function() {
			$(this).css("color", "red");
		}).mouseout(function() {
			$(this).css("color", "");
		});
 */
		// 重置密码
		function updatePwd(obj) {
			var id = $(obj).attr("guid");
			var param = {};
			param["guid"] = id;
			param["random"] = newGuid();
			var url = "/CompareSystem/web/updatePwd.do";
			$.post(url, param, function(data, textStatus) {
				if (textStatus != "success") {
					alert("请求错误！");
					return;
				}
				if (!data.success) {
					alert("后台发生错误！");
					return;
				}

				myobj = data;

				if (myobj == undefined) {
					alert("未获取到数据！");
					return;
				}
				if (myobj["sessionState"] == 0) {
					window.location.href = "/CompareSystem/login.html?data=" + new Date().getTime();
					return;
				}

				if (myobj["success"]) {
					$(obj).parent().parent().find("td:eq(2)").html("111111");
				} else {
					alert(myobj["info"]);
				}
				$("#loading_Shadow").hide();
			});
		}

		//展示所有的父级类别
		function showAllType() {
			$("<option/>", {
				val : "",
				text : "--- 请选择用户类型 ---",
				selected : "selected"
			}).appendTo($("#parenttype"))
			for ( var key in typePareArr) {
				$("<option/>", {
					val : key,
					text : typePareArr[key]
				}).appendTo($("#parenttype"))
			}
		}
		$("#user_list_filter").hide();

		//跳转到编辑页面
		function gotoEdit(obj){
			var index = layer.open({
				type : 2,
				title : "用户编辑",
				content : "user-add.html"
			});
			layer.full(index);
			window.row=$(obj).attr("row");
			// window.location.href='user-add.html?' +encodeURIComponent('row='+$(obj).attr("row")+'&editOrAdd=用户编辑');
		}
		
		/*资讯-添加*/
		function article_add(title, url, w, h) {
			row=null;
			var index = layer.open({
				type : 2,
				title : title,
				content : url
			});
			layer.full(index);
		}
		/* function article_edit(title, url, w, h){
			
		} */
		
	</script>
	<!--/请在上方写此页面业务相关的脚本-->
</body>

</html>